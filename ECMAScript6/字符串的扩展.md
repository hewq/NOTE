# å­—ç¬¦ä¸²çš„æ‰©å±•

- <a href="#1">å­—ç¬¦çš„Â UnicodeÂ è¡¨ç¤ºæ³•</a>
- <a href="#2">codePointAt()</a>
- <a href="#3">String.fromCodePoint()</a>
- <a href="#4">å­—ç¬¦ä¸²çš„éå†å™¨æ¥å£</a>
- <a href="#5">normalize()</a>
- <a href="#6">includes(),Â startsWith(),Â endsWith()</a>
- <a href="#7">repeat()</a>
- <a href="#8">padStart(),Â padEnd()</a>
- <a href="#9">matchAll()</a>
- <a href="#10">æ¨¡æ¿å­—ç¬¦ä¸²</a>
- <a href="#11">å®ä¾‹ï¼šæ¨¡æ¿ç¼–è¯‘</a>
- <a href="#12">æ ‡ç­¾æ¨¡æ¿</a>
- <a href="#13">String.raw()</a>
- <a href="#14">æ¨¡æ¿å­—ç¬¦ä¸²çš„é™åˆ¶</a>

## <a name="1">å­—ç¬¦çš„ Unicode è¡¨ç¤ºæ³•</a>

JavaScript å…è®¸é‡‡ç”¨`\xxxx`å½¢å¼è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­`xxxx`è¡¨ç¤ºå­—ç¬¦çš„ Unicode ç ç‚¹ã€‚

```javascript
console.log('\u0061'); // a
```

ä½†æ˜¯ï¼Œè¿™ç§è¡¨ç¤ºæ³•åªé™äºç ç‚¹åœ¨`\u0000`ï½`\uFFFF`ä¹‹é—´çš„å­—ç¬¦ã€‚è¶…å‡ºè¿™ä¸ªèŒƒå›´çš„å­—ç¬¦ï¼Œå¿…é¡»ç”¨ä¸¤ä¸ªåŒå­—èŠ‚è¡¨ç¤ºã€‚

```javascript
console.log('\uD842\uDFB7'); // ğ ®·

console.log('\u20BB7'); // â‚»7
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœç›´æ¥åœ¨`\u`åé¢è·Ÿä¸Šè¶…è¿‡`0xFFFF`çš„æ•°å€¼ï¼ˆæ¯”å¦‚`\u20BB7`ï¼‰ï¼ŒJavaScript ä¼šç†è§£æˆ`\u200BB+7`ã€‚ç”±äº`\u20BB`æ˜¯ä¸€ä¸ªä¸å¯æ‰“å°å­—ç¬¦ï¼Œåé¢è·Ÿç€ä¸€ä¸ª`7`ã€‚

ES6 å¯¹è¿™ä¸€ç‚¹åšå‡ºäº†æ”¹è¿›ï¼Œåªè¦å°†ç ç‚¹æ”¾å…¥å¤§æ‹¬å·ï¼Œå°±èƒ½æ­£ç¡®è§£è¯»è¯¥å­—ç¬¦ã€‚

```javascript
console.log('\u{20BB7}'); // ğ ®·

console.log('\u{41}\u{42}\u{43}'); // ABC

let hello = 123;
console.log(hell\u{6F}); // 123

console.log('\u{1F680}', '\uD83D\uDE80'); // ğŸš€ ğŸš€
console.log('\u{1F680}' === '\uD83D\uDE80'); // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæœ€åä¸€ä¸ªä¾‹å­è¡¨æ˜ï¼Œå¤§æ‹¬å·è¡¨ç¤ºæ³•ä¸å››å­—èŠ‚çš„ UTF-16 ç¼–ç æ˜¯ç­‰ä»·çš„ã€‚

æœ‰äº†è¿™ç§è¡¨ç¤ºæ³•ä¹‹åï¼ŒJavaScript å…±æœ‰ 6 ç§æ–¹æ³•å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚

```javascript
console.log('\z' === 'z'); // true
console.log('\172' === 'z'); // true
console.log('\x7A' === 'z'); // true
console.log('\u007A' === 'z'); // true
console.log('\u{7A}' === 'z'); // true
```

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n01.js)

## <a name="2">codePointAt()</a>

JavaScript å†…éƒ¨ï¼Œå­—ç¬¦ä»¥ UTF-16 çš„æ ¼å¼å‚¨å­˜ï¼Œæ¯ä¸ªå­—ç¬¦å›ºå®šä¸º`2`ä¸ªå­—èŠ‚ã€‚å¯¹äºé‚£äº›éœ€è¦`4`ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼ˆUnicode ç ç‚¹å¤§äº`0xFFFF`çš„å­—ç¬¦ï¼‰ï¼ŒJavaScript ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªå­—ç¬¦ã€‚

```javascript
var s = "ğ ®·";

console.log(s.length); // 2
console.log(s.charAt(0)); // ï¿½
console.log(s.charAt(1)); // ï¿½
console.log(s.charCodeAt(0)); // 55362
console.log(s.charCodeAt(1)); // 57271
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ±‰å­—â€œğ ®·â€çš„ç ç‚¹æ˜¯`0x20BB7`ï¼ŒUTF-16 ç¼–ç ä¸º`0xD842 0xDFB7`ï¼ˆåè¿›åˆ¶ä¸º`55362 57271`ï¼‰ï¼Œéœ€è¦`4`ä¸ªå­—èŠ‚å‚¨å­˜ã€‚å¯¹äºè¿™ç§`4`ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼ŒJavaScript ä¸èƒ½æ­£ç¡®å¤„ç†ï¼Œå­—ç¬¦é•¿åº¦ä¼šè¯¯åˆ¤ä¸º`2`ï¼Œè€Œä¸”`charAt`æ–¹æ³•æ— æ³•è¯»å–æ•´ä¸ªå­—ç¬¦ï¼Œ`charCodeAt`æ–¹æ³•åªèƒ½åˆ†åˆ«è¿”å›å‰ä¸¤ä¸ªå­—èŠ‚å’Œåä¸¤ä¸ªå­—èŠ‚çš„å€¼ã€‚

ES6 æä¾›äº†`codePointAt`æ–¹æ³•ï¼Œèƒ½å¤Ÿæ­£ç¡®å¤„ç† 4 ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ã€‚

```javascript
let c = 'ğ ®·a';

console.log(c.codePointAt(0)); // 134071
console.log(c.codePointAt(1)); // 57271
console.log(c.codePointAt(2)); // 97
```

`codePointAt`æ–¹æ³•çš„å‚æ•°ï¼Œæ˜¯å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ï¼ˆä» 0 å¼€å§‹ï¼‰ã€‚ä¸Šé¢ä»£ç ä¸­ï¼ŒJavaScript å°†â€œğ ®·aâ€è§†ä¸ºä¸‰ä¸ªå­—ç¬¦ï¼ŒcodePointAt æ–¹æ³•åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œæ­£ç¡®åœ°è¯†åˆ«äº†â€œğ ®·â€ï¼Œè¿”å›äº†å®ƒçš„åè¿›åˆ¶ç ç‚¹ 134071 ï¼ˆå³åå…­è¿›åˆ¶çš„`20BB7`ï¼‰ã€‚åœ¨ç¬¬äºŒä¸ªå­—ç¬¦ï¼ˆå³â€œğ ®·â€çš„åä¸¤ä¸ªå­—èŠ‚ï¼‰å’Œç¬¬ä¸‰ä¸ªå­—ç¬¦â€œaâ€ä¸Šï¼Œ`codePointAt`æ–¹æ³•çš„ç»“æœä¸`charPointAt`æ–¹æ³•ç›¸åŒã€‚

æ€»ä¹‹ï¼Œ`codePointAt`æ–¹æ³•ä¼šæ­£ç¡®è¿”å› 32 ä½çš„ UTF-16 å­—ç¬¦çš„ç ç‚¹ã€‚å¯¹äºé‚£äº›ä¸¤ä¸ªå­—èŠ‚å‚¨å­˜çš„å¸¸è§„å­—ç¬¦ï¼Œå®ƒçš„è¿”å›ç»“æœä¸`charCodeAt`æ–¹æ³•ç›¸åŒã€‚

`codePointAt`æ–¹æ³•è¿”å›çš„æ˜¯ç ç‚¹çš„åè¿›åˆ¶å€¼ï¼Œå¦‚æœæƒ³è¦åå…­è¿›åˆ¶çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨`toString`æ–¹æ³•è½¬æ¢ä¸€ä¸‹ã€‚

```javascript
let x = 'ğ ®·a';

console.log(x.codePointAt(0).toString(16)); // 20bb7
console.log(x.codePointAt(2).toString(16)); // 61
```

ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œ`codePointAt`æ–¹æ³•çš„å‚æ•°ä»ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚æ¯”å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦`a`åœ¨å­—ç¬¦ä¸²`s`çš„æ­£ç¡®ä½ç½®åºå·åº”è¯¥æ˜¯ 1ï¼Œä½†æ˜¯å¿…é¡»å‘`codePointAt`æ–¹æ³•ä¼ å…¥ 2ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªåŠæ³•æ˜¯ä½¿ç”¨`forâ€¦of`å¾ªç¯ï¼Œå› ä¸ºå®ƒä¼šæ­£ç¡®è¯†åˆ« 32 ä½çš„ UTF-16 å­—ç¬¦ã€‚

```javascript
let a = 'ğ ®·a';
for (let ch of a) {
	console.log(ch.codePointAt(0).toString(16));
}
// 20bb7
// 61
```

`codePointAt`æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªå­—ç¬¦ç”±ä¸¤ä¸ªå­—èŠ‚è¿˜æ˜¯ç”±å››ä¸ªå­—èŠ‚ç»„æˆçš„æœ€ç®€å•æ–¹æ³•ã€‚

```javascript
function is32Bit(c) {
	return c.codePointAt(0) > 0xFFFF;
}

console.log(is32Bit('ğ ®·')); // true
console.log(is32Bit('a')); // false
```

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n02.js)

## <a name="3">String.fromCodePoint()</a>

ES5 æä¾›`String.fromCharCode`æ–¹æ³•ï¼Œç”¨äºä»ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¯†åˆ« 32 ä½çš„ UTF-16 å­—ç¬¦ï¼ˆUnicode ç¼–å·å¤§äº`0xFFFF`ï¼‰ã€‚

```javascript
console.log(String.fromCharCode(0x20BB7)); // à®·
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`String.fromCharCode`ä¸èƒ½è¯†åˆ«å¤§äº`0xFFFF`çš„ç ç‚¹ï¼Œæ‰€ä»¥`0x20bb7`å°±å‘ç”Ÿäº†æº¢å‡ºï¼Œæœ€é«˜ä½`2`è¢«èˆå¼ƒï¼Œæœ€åè¿”å›ç ç‚¹`U+0BB7`å¯¹åº”çš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯ç ç‚¹`U+20BB7`å¯¹åº”çš„å­—ç¬¦ã€‚

ES6 æä¾›äº†`String.fromCodePoint`æ–¹æ³•ï¼Œå¯ä»¥è¯†åˆ«å¤§äº`0xFFFF`çš„å­—ç¬¦ï¼Œå¼¥è¡¥äº†`String.fromCharCode`æ–¹æ³•çš„ä¸è¶³ã€‚åœ¨ä½œç”¨ä¸Šï¼Œæ­£å¥½ä¸`codePointAt`æ–¹æ³•ç›¸åã€‚

```javascript
console.log(String.fromCodePoint(0x20BB7)); // ğ ®·

console.log(String.fromCodePoint(0x78, 0x1f680, 0x79) === 'x\uD83D\uDE80y'); // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœ`String.fromCodePoint`æ–¹æ³•æœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™å®ƒä»¬ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚

æ³¨æ„ï¼Œ`fromCodePoint`æ–¹æ³•å®šä¹‰åœ¨`String`å¯¹è±¡ä¸Šï¼Œè€Œ`codePointAt`æ–¹æ³•å®šä¹‰åœ¨å­—ç¬¦ä¸²çš„å®ä¾‹å¯¹è±¡ä¸Šã€‚

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n03.js)

## <a name="4">å­—ç¬¦ä¸²çš„éå†å™¨æ¥å£</a>

ES6 ä¸ºå­—ç¬¦ä¸²æ·»åŠ äº†éå†å™¨æ¥å£ï¼Œä½¿å¾—å­—ç¬¦ä¸²å¯ä»¥è¢«`forâ€¦of`å¾ªç¯éå†ã€‚

```javascript
for (let codePoint of 'foo') {
	console.log(codePoint);
}
// f
// o
// o
```

é™¤äº†éå†å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªéå†å™¨æœ€å¤§çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¯†åˆ«å¤§äº`0xFFFF`çš„ç ç‚¹ï¼Œä¼ ç»Ÿçš„`for`å¾ªç¯æ— æ³•è¯†åˆ«è¿™æ ·çš„ç ç‚¹ã€‚

```javascript
let text = String.fromCodePoint(0x20BB7);

for (let i = 0; i < text.length; i++) {
	console.log(text[i]);
}
// ï¿½
// ï¿½

for (let i of text) {
	console.log(i);
}
// ğ ®·
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²`text`åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯`for`å¾ªç¯ä¼šè®¤ä¸ºå®ƒåŒ…å«ä¸¤ä¸ªå­—ç¬¦ï¼ˆéƒ½ä¸å¯æ‰“å°ï¼‰ï¼Œè€Œ`forâ€¦of`å¾ªç¯ä¼šæ­£ç¡®è¯†åˆ«å‡ºè¿™ä¸€ä¸ªå­—ç¬¦ã€‚

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n04.js)

## <a name="5">normalize()</a>

è®¸å¤šæ¬§æ´²è¯­è¨€æœ‰è¯­è°ƒç¬¦å·å’Œé‡éŸ³ç¬¦å·ã€‚ä¸ºäº†è¡¨ç¤ºå®ƒä»¬ï¼ŒUnicode æä¾›äº†ä¸¤ç§æ–¹æ³•ã€‚ä¸€ç§æ˜¯ç›´æ¥æä¾›å¸¦é‡éŸ³ç¬¦å·çš„å­—ç¬¦ï¼Œæ¯”å¦‚`Ç‘`ï¼ˆ\u01D1ï¼‰ã€‚å¦ä¸€ç§æ˜¯æä¾›åˆæˆç¬¦å·ï¼ˆcombining characterï¼‰ï¼Œå³åŸå­—ç¬¦ä¸é‡éŸ³ç¬¦å·çš„åˆæˆï¼Œä¸¤ä¸ªå­—ç¬¦åˆæˆä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚`o`ï¼ˆ\u004Fï¼‰å’Œ`Ë‡`ï¼ˆ\u030Cï¼‰åˆæˆ`Ç‘`ï¼ˆ\u004F\u030Cï¼‰ã€‚

è¿™ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼Œåœ¨è§†è§‰å’Œè¯­ä¹‰ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯ JavaScript ä¸èƒ½è¯†åˆ«ã€‚

```javascript
console.log('\u01D1' === '\u004F\u030C'); // false
console.log('\u01D1'.length); // 1
console.log('\u004F\u030C'.length); // 2
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼ŒJavaScript å°†åˆæˆå­—ç¬¦è§†ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ä¸ç›¸ç­‰ã€‚

ES6 æä¾›å­—ç¬¦å®åŠ›çš„`normalize()`æ–¹æ³•ï¼Œç”¨æ¥å°†å­—ç¬¦çš„ä¸åŒè¡¨ç¤ºæ–¹æ³•ç»Ÿä¸€ä¸ºåŒæ ·çš„å½¢å¼ï¼Œè¿™ç§°ä¸º Unicode æ­£è§„åŒ–ã€‚

```javascript
console.log('\u01D1'.normalize() === '\u004F\u030C'.normalize()); // true
```

`normalize`æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®š`normalize`çš„æ–¹å¼ï¼Œå‚æ•°çš„å››ä¸ªå¯é€‰å€¼å¦‚ä¸‹ã€‚

- `NFC`ï¼Œé»˜è®¤å‚æ•°ï¼Œè¡¨ç¤ºâ€œæ ‡å‡†ç­‰ä»·åˆæˆâ€ï¼ˆNormalization Form Canonical Compositionï¼‰ï¼Œè¿”å›å¤šä¸ªç®€å•å­—ç¬¦çš„åˆæˆå­—ç¬¦ã€‚æ‰€è°“â€œæ ‡å‡†ç­‰ä»·â€æŒ‡çš„æ˜¯è§†è§‰å’Œè¯­ä¹‰ä¸Šçš„ç­‰ä»·ã€‚
- `NFD`ï¼Œè¡¨ç¤ºâ€œæ ‡å‡†ç­‰ä»·åˆ†è§£â€ï¼ˆNormalization Form Cannonical Decompositionï¼‰ï¼Œå³åœ¨æ ‡å‡†ç­‰ä»·çš„å‰æä¸‹ï¼Œè¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦ã€‚
- `NFKC`ï¼Œè¡¨ç¤ºâ€œå…¼å®¹ç­‰ä»·åˆæˆâ€ï¼ˆNormalization Form Compatibility Compositionï¼‰ï¼Œè¿”å›åˆæˆå­—ç¬¦ã€‚æ‰€è°“â€œå…¼å®¹ç­‰ä»·â€æŒ‡çš„æ˜¯è¯­ä¹‰ä¸Šå­˜åœ¨ç­‰ä»·ï¼Œä½†è§†è§‰ä¸Šä¸ç­‰ä»·ã€‚æ¯”å¦‚â€œå›â€å’Œâ€œå–œå–œâ€ã€‚ï¼ˆè¿™åªæ˜¯ç”¨æ¥ä¸¾ä¾‹ï¼Œ`normalize`æ–¹æ³•ä¸èƒ½è¯†åˆ«ä¸­æ–‡ã€‚ï¼‰
- `NFKD`ï¼Œè¡¨ç¤ºâ€œå…¼å®¹ç­‰ä»·åˆ†è§£â€ï¼ˆNormalization Form Compatibility Decompositionï¼‰ï¼Œå³åœ¨å…¼å®¹ç­‰ä»·çš„å‰æä¸‹ï¼Œè¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦ã€‚

```javascript
console.log('\u004F\u030C'.normalize('NFC').length); // 1
console.log('\u004F\u030C'.normalize('NFD').length); // 2
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œ`NFC`å‚æ•°è¿”å›å­—ç¬¦çš„åˆæˆå½¢å¼ï¼Œ`NFD`å‚æ•°è¿”å›å­—ç¬¦çš„åˆ†è§£å½¢å¼ã€‚

ä¸è¿‡ï¼Œ`normalize`æ–¹æ³•ç›®å‰ä¸èƒ½è¯†åˆ«ä¸‰ä¸ªæˆ–ä¸‰ä¸ªä»¥ä¸Šå­—ç¬¦çš„åˆæˆã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯åªèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé€šè¿‡ Unicode ç¼–å·åŒºé—´åˆ¤æ–­ã€‚

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n05.js)

## <a name="6">includes(), startsWith(), endsWith()</a>

ä¼ ç»Ÿä¸Šï¼ŒJavaScript åªæœ‰`indexOf`æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥ç¡®å®šä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚ES6 åˆæä¾›äº†ä¸‰ç§æ–°æ–¹æ³•ã€‚

- includes()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°äº†å‚æ•°å­—ç¬¦ä¸²ã€‚
- startsWith()ï¼š è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å¤´éƒ¨ã€‚
- endsWith()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚

```javascript
let s = 'Hello World!';

console.log(s.startsWith('Hello')); // true
console.log(s.endsWith('!')); // true
console.log(s.includes('o')); // true
```

è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå¼€å§‹æœç´¢çš„ä½ç½®ã€‚

```javascript
let c = 'Hello world!';

console.log(c.startsWith('world', 6)); // true
console.log(c.endsWith('Hello', 5)); // true
console.log(c.includes('Hello', 5)); // false
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œä½¿ç”¨ç¬¬äºŒå‚æ•°`n`æ—¶ï¼Œ`endsWith`çš„è¡Œä¸ºä¸å…¶ä»–ä¸¤ä¸ªæ–¹æ³•æœ‰æ‰€ä¸åŒã€‚å®ƒé’ˆå¯¹å‰`n`ä¸ªå­—ç¬¦ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªæ–¹æ³•é’ˆå¯¹ä»ç¬¬`n`ä¸ªä½ç½®ç›´åˆ°å­—ç¬¦ä¸²ç»“æŸã€‚

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n06.js)

## <a name="7">repeat()</a>

`repeat`æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤`n`æ¬¡ã€‚

```javascript
console.log('x'.repeat(3)); // xxx
console.log('hello'.repeat(2)); // hellohello
console.log('na'.repeat(0)); // ""
```

å‚æ•°å¦‚æœæ˜¯å°æ•°ï¼Œä¼šè¢«å–æ•´ã€‚

```javascript
console.log('na'.repeat(2.9)); // nana
```

å¦‚æœ`repeat`çš„å‚æ•°æ˜¯è´Ÿæ•°æˆ–è€…`Infinity`ï¼Œä¼šæŠ¥é”™ã€‚

```javascript
'na'.repeat(Infinity); // RangeError: Invalid count value
'na'.repeat(-1); // RangeError: Invalid count value
```

ä½†æ˜¯ï¼Œå¦‚æœå‚æ•°æ˜¯ 0 åˆ° -1 ä¹‹é—´åˆ°å°æ•°ï¼Œåˆ™ç­‰åŒäº 0ï¼Œè¿™æ˜¯å› ä¸ºä¼šå…ˆè¿›è¡Œå–æ•´è¿ç®—ã€‚0 åˆ° -1 ä¹‹é—´åˆ°å°æ•°ï¼Œå–æ•´ä»¥åç­‰äº`-0`ï¼Œ`repeat`è§†åŒä¸º 0ã€‚

```javascript
console.log('na'.repeat(-0.9)); // ""
```

å‚æ•°`NaN`ç­‰åŒäº 0ã€‚

```javascript
console.log('na'.repeat(NaN)); // ""
```

å¦‚æœ`repeat`çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šå…ˆè½¬ä¸ºæ•°å­—ã€‚

```javascript
console.log('na'.repeat('na')); // ""
console.log('na'.repeat('3')); // nanana
```

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n07.js)

## <a name="8">padStart(), padEnd()</a>

ES2017 å¼•å…¥äº†å­—ç¬¦ä¸²è¡¥å…¨é•¿åº¦çš„åŠŸèƒ½ã€‚å¦‚æœæŸä¸ªå­—ç¬¦ä¸²ä¸å¤ŸæŒ‡å®šé•¿åº¦ï¼Œä¼šåœ¨å¤´éƒ¨æˆ–å°¾éƒ¨è¡¥å…¨ã€‚

```javascript
console.log('x'.padStart(5, 'ab')); // ababx
console.log('x'.padStart(4, 'ab')); // abax

console.log('x'.padEnd(5, 'ab')); // xabab
console.log('x'.padEnd(4, 'ab')); // xaba
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`padStart()`å’Œ`padEnd()`ä¸€å…±æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²è¡¥å…¨ç”Ÿæ•ˆçš„æœ€å¤§é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥è¡¥å…¨çš„å­—ç¬¦ä¸²ã€‚

å¦‚æœåŸå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç­‰äºæˆ–å¤§äºæœ€å¤§é•¿åº¦ï¼Œåˆ™å­—ç¬¦ä¸²è¡¥å…¨ä¸ç”Ÿæ•ˆï¼Œè¿”å›åŸå­—ç¬¦ä¸²ã€‚

```javascript
console.log('xxx'.padStart(2, 'ab')); // xxx
console.log('xxx'.padEnd(2, 'ab')); // xxx
```

å¦‚æœç”¨æ¥è¡¥å…¨çš„å­—ç¬¦ä¸²ä¸åŸå­—ç¬¦ä¸²ï¼Œä¸¤è€…çš„é•¿åº¦ä¹‹å’Œè¶…è¿‡äº†æœ€å¤§é•¿åº¦ï¼Œåˆ™ä¼šæˆªå»è¶…å‡ºä½æ•°çš„è¡¥å…¨å­—ç¬¦ä¸²ã€‚

```javascript
console.log('abc'.padStart(10, '0123456789')); // 0123456abc
```

å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨ç©ºæ ¼è¡¥å…¨é•¿åº¦ã€‚

```javascript
console.log('x'.padStart(4)); // '   x'
console.log('x'.padEnd(4)); // 'x   '
```

`padStart()`çš„å¸¸è§ç”¨é€”æ˜¯ä¸ºæ•°å€¼è¡¥å…¨æŒ‡å®šä½æ•°ã€‚ä¸‹é¢ä»£ç ç”Ÿæˆ 10 ä½çš„æ•°å€¼å­—ç¬¦ä¸²ã€‚

```javascript
console.log('1'.padStart(10, '0')); // 0000000001
console.log('12'.padStart(10, '0')); // 0000000001
console.log('123456'.padStart(10, '0')); // 0000123456
```

å¦ä¸€ä¸ªç”¨é€”æ˜¯æç¤ºå­—ç¬¦ä¸²æ ¼å¼

```javascript
console.log('12'.padStart(10, 'YYYY-MM-DD')); // YYYY-MM-12
console.log('09-12'.padStart(10, 'YYYY-MM-DD')); // YYYY-09-12
```

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n08.js)

## <a name="9">matchAll()</a>

`matchAll`æ–¹æ³•è¿”å›ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å½“å‰å­—ç¬¦ä¸²çš„æ‰€æœ‰åŒ¹é…ã€‚

## <a name="10">æ¨¡æ¿å­—ç¬¦ä¸²</a>

ä¼ ç»Ÿçš„ JavaScript è¯­è¨€ï¼Œè¾“å‡ºæ¨¡æ¿é€šå¸¸æ˜¯è¿™æ ·å†™çš„ï¼ˆä¸‹é¢ä½¿ç”¨äº† jQuery çš„æ–¹æ³•ï¼‰ã€‚

```javascript
$('#result').append(
	'There are <b>' + basket.count + '</b> ' +
    'items in your basket, ' +
    '<em>' + basket.onSale +
    '</em> are on sale!'
);
```

ä¸Šé¢è¿™ç§å†™æ³•ç›¸å½“ç¹çä¸æ–¹ä¾¿ï¼ŒES6 å¼•å…¥äº†æ¨¡æ¿å­—ç¬¦ä¸²è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```javascript
$('#result').append(`
	There are <b>${basket.count}</b> items
	in your basket, <em>${basket.onSale}</em>
	are on sale!
`);
```

æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆtemplate stringï¼‰æ˜¯å¢å¼ºç‰ˆçš„å­—ç¬¦ä¸²ï¼Œç”¨åå°å·ï¼ˆ`ï¼‰æ ‡è¯†ã€‚å®ƒå¯ä»¥å½“ä½œæ™®é€šå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ã€‚

```javascript
// æ™®é€šå­—ç¬¦ä¸²
`In JavaScript '\\n' is a line-feed.`;

// å¤šè¡Œå­—ç¬¦ä¸²
`In JavaScript this is
not legal.`

console.log(`string text line 1
	string text line 2`);

// å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡
let name = 'Bob', time = 'today';
`Hello ${name}, how are you ${time}?`
```

ä¸Šé¢ä»£ç ä¸­çš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯ç”¨åå¼•å·è¡¨ç¤ºã€‚å¦‚æœåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­éœ€è¦ä½¿ç”¨åå¼•å·ï¼Œåˆ™å‰é¢è¦ç”¨åæ–œæ è½¬ä¹‰ã€‚

```javascript
let greeting = `\`Yo\` World!`;
```

å¦‚æœä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œæ‰€æœ‰çš„ç©ºæ ¼å’Œç¼©è¿›éƒ½ä¼šè¢«ä¿ç•™åœ¨è¾“å‡ºä¹‹ä¸­ã€‚

```javascript
$('#list').html(`
<ul>
	<li>first</li>
	<li>second</li>
</ul>
`);
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ‰€æœ‰æ¨¡æ¿å­—ç¬¦ä¸²çš„ç©ºæ ¼å’Œæ¢è¡Œéƒ½ä¼šè¢«ä¿ç•™çš„ï¼Œæ¯”å¦‚`<ul>`æ ‡ç­¾å‰é¢ä¼šæœ‰ä¸€ä¸ªæ¢è¡Œã€‚å¦‚æœä½ ä¸æƒ³è¦è¿™ä¸ªæ¢è¡Œï¼Œå¯ä»¥ä½¿ç”¨`trim`æ–¹æ³•æ¶ˆé™¤å®ƒã€‚

```javascript
$('#list').html(`
<ul>
	<li>first</li>
	<li>second</li>
</ul>
`.trim());
```

æ¨¡æ¿å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ï¼Œéœ€è¦å°†å˜é‡åå†™åœ¨`${}`ä¹‹ä¸­ã€‚

```javascript
function authorize(user, action) {
    if (!user.hasPrivilege(action)) {
        throw new Error(
        	// ä¼ ç»Ÿçš„å†™æ³•
            // 'User '
            // + User.name
            // + ' is not authorized to do '
            // + action
            // + '.'
            `User ${user.name} is not authorized to do ${action}.`);
    }
}
```

å¤§æ‹¬å·å†…éƒ¨å¯ä»¥æ”¾å…¥ä»»æ„çš„ JavaScript è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿›è¡Œè¿ç®—ï¼Œä»¥åŠå¼•ç”¨å¯¹è±¡å±æ€§ã€‚

```javascript
let x = 1;
let y = 2;

console.log(`${x} + ${y} = ${x + y}`); // 1 + 2 = 3
console.log(`${x} + ${y * 2} = ${x + y * 2}`);  // 1 + 4 = 5

let obj = {x: 1, y: 2};
console.log(`${obj.x + obj.y}`);  // 3
```

æ¨¡æ¿å­—ç¬¦ä¸²ä¹‹ä¸­è¿˜èƒ½è°ƒç”¨å‡½æ•°ã€‚

```javascript
function fn() {
	return 'Hello World';
}

console.log(`foo ${fn()} bar`); // foo Hello World bar
```

æ¨¡æ¿å­—ç¬¦ä¸²ä¹‹ä¸­è¿˜èƒ½è°ƒç”¨å‡½æ•°ã€‚

```javascript
function fn() {
	return 'Hello World';
}

console.log(`foo ${fn()} bar`); // foo Hello World bar
```

å¦‚æœå¤§æ‹¬å·ä¸­çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°†æŒ‰ç…§ä¸€èˆ¬çš„è§„åˆ™è½¬ä¸ºå­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼Œå¤§æ‹¬å·ä¸­æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†é»˜è®¤è°ƒç”¨å¯¹è±¡çš„`toString`æ–¹æ³•ã€‚

å¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ²¡æœ‰å£°æ˜ï¼Œå°†æŠ¥é”™ã€‚

```javascript
// å˜é‡ place æ²¡æœ‰å£°æ˜
let msg = `Hello, ${place}`; // ReferenceError: place is not defined
```

ç”±äºæ¨¡æ¿å­—ç¬¦ä¸²çš„å¤§æ‹¬å·å†…éƒ¨ï¼Œå°±æ˜¯æ‰§è¡Œ JavaScript ä»£ç ï¼Œå› æ­¤å¦‚æœå¤§æ‹¬å·å†…éƒ¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†ä¼šåŸæ ·è¾“å‡ºã€‚

```javascript
console.log(`Hello ${'world'}`); // Hello world
```

æ¨¡æ¿å­—ç¬¦ä¸²ç”šè‡³è¿˜èƒ½åµŒå¥—ã€‚

```javascript
const tmpl = addrs => `
	<table>
		${addrs.map(addrs => `
			<tr><td>${addr.first}</td></tr>
			<tr><td>${addr.last}</td></tr>
		`).join('')}
	</table>
`;
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²çš„å˜é‡ä¹‹ä¸­ï¼ŒåˆåµŒå…¥å¦ä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚

```javascript
const data = [
  { first: '<Jane>', last: 'Bond' },
  { first: 'Lars', last: '<Croft>' }
];
console.log(tmpl(data));
```

å¦‚æœéœ€è¦å¼•ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«ï¼Œåœ¨éœ€è¦æ—¶æ‰§è¡Œï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ã€‚

```javascript
// å†™æ³•ä¸€
let str = 'return ' + '`Hello ${name}!`';
let func = new Function('name', str);
console.log(func('Jack')); // Hello Jack

// å†™æ³•äºŒ
let str2 = '(name) => `Hello ${name}!`';
let func2 = eval.call(null, str2);
console.log(func2('Jack')); // Hello Jack
```

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n09.js)

## <a name="11">å®ä¾‹ï¼šæ¨¡æ¿ç¼–è¯‘</a>

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé€šè¿‡æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œç”Ÿæˆæ­£å¼æ¨¡æ¿çš„å®ä¾‹ã€‚

```javascript
let template = `
<ul>
	<% for(let i = 0; i < data.supplies.length; i++) {%>
		<li><%= data.supplies[i] %></li>
	<% } %>
</ul>
`;
```

ä¸€ç§æ€è·¯æ˜¯å°†å…¶è½¬æ¢ä¸º JavaScript è¡¨è¾¾å¼å­—ç¬¦ä¸²ã€‚

```javascript
echo('<ul>');
for(let i=0; i < data.supplies.length; i++) {
  echo('<li>');
  echo(data.supplies[i]);
  echo('</li>');
};
echo('</ul>');
```

è¿™ä¸ªè½¬æ¢ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å°±è¡Œäº†ã€‚

```javascript
let evalExpr = /<%=(.+?)%>/g;
let expr = /<%([\s\S]+?)%>/g;

template = template
  .replace(evalExpr, '`); \n  echo( $1 ); \n  echo(`')
  .replace(expr, '`); \n $1 \n  echo(`');

template = 'echo(`' + template + '`);';
```

ç„¶åï¼Œå°†`template`å°è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢è¿”å›ï¼Œå°±å¯ä»¥äº†ã€‚

```javascript
let script =
`(function parse(data){
  let output = "";

  function echo(html){
    output += html;
  }

  ${ template }

  return output;
})`;

return script;
```

å°†ä¸Šé¢å†…å®¹æ‹¼è£…æˆä¸€ä¸ªæ¨¡æ¿ç¼–è¯‘å‡½æ•°`compile`ã€‚

```javascript
function compile(template){
  const evalExpr = /<%=(.+?)%>/g;
  const expr = /<%([\s\S]+?)%>/g;

  template = template
    .replace(evalExpr, '`); \n  echo( $1 ); \n  echo(`')
    .replace(expr, '`); \n $1 \n  echo(`');

  template = 'echo(`' + template + '`);';

  let script =
  `(function parse(data){
    let output = "";

    function echo(html){
      output += html;
    }

    ${ template }

    return output;
  })`;

  return script;
}
```

`compile`å‡½æ•°çš„ç”¨æ³•å¦‚ä¸‹ã€‚

```javascript
let parse = eval(compile(template));
console.log(parse({ supplies: ['broom', 'mop', 'cleaner']}));
// <ul>

// 		<li>broom</li>

// 		<li>mop</li>

// 		<li>cleaner</li>

// </ul>
```

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n10.js)

## <a name="12">æ ‡ç­¾æ¨¡æ¿</a>

æ¨¡æ¿å­—ç¬¦ä¸²çš„åŠŸèƒ½ï¼Œä¸ä»…ä»…æ˜¯ä¸Šé¢è¿™äº›ã€‚å®ƒå¯ä»¥ç´§è·Ÿåœ¨ä¸€ä¸ªå‡½æ•°åé¢ï¼Œè¯¥å‡½æ•°å°†è¢«è°ƒç”¨æ¥å¤„ç†è¿™ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ã€‚è¿™è¢«ç§°ä¸º"æ ‡ç­¾æ¨¡æ¿"åŠŸèƒ½ï¼ˆtagged templateï¼‰ã€‚

```javascript
alert`123`
// ç­‰åŒäº
alert(123);
```

æ ‡ç­¾æ¨¡æ¿å…¶å®ä¸æ˜¯æ¨¡æ¿ï¼Œè€Œæ˜¯å‡½æ•°è°ƒç”¨çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚"æ ‡ç­¾"æŒ‡çš„å°±æ˜¯å‡½æ•°ï¼Œç´§è·Ÿåœ¨åé¢çš„æ¨¡æ¿å­—ç¬¦ä¸²å°±æ˜¯å®ƒçš„å‚æ•°ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²é‡Œé¢æœ‰å˜é‡ï¼Œå°±ä¸æ˜¯ç®€å•çš„è°ƒç”¨äº†ï¼Œè€Œæ˜¯ä¼šå°†æ¨¡æ¿å­—ç¬¦ä¸²å…ˆå¤„ç†æˆå¤šä¸ªå‚æ•°ï¼Œå†è°ƒç”¨å‡½æ•°ã€‚

```javascript
let a = 5;
let b = 10;

tag`Hello ${ a + b } world ${ a * b }`;
// ç­‰åŒäº
tag(['Hello ', ' world', ''], 15, 50);
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å‰é¢æœ‰ä¸€ä¸ªæ ‡è¯†å`tag`ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ•´ä¸ªè¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå°±æ˜¯`tag`å‡½æ•°å¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²åçš„è¿”å›å€¼ã€‚

å‡½æ•°`tag`ä¾æ¬¡ä¼šæ¥æ”¶åˆ°å¤šä¸ªå‚æ•°ã€‚

```javascript
function tag(stringArr, value1, value2) {
	// ...
}
// ç­‰åŒäº
function tag(stringArr, ...values) {
	// ...
}
```

`tag`å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æˆå‘˜æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ä¸­é‚£äº›æ²¡æœ‰å˜é‡æ›¿æ¢çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå˜é‡æ›¿æ¢åªå‘ç”Ÿåœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ä¸ç¬¬äºŒä¸ªæˆå‘˜ä¹‹é—´ã€ç¬¬äºŒä¸ªæˆå‘˜ä¸ç¬¬ä¸‰ä¸ªæˆå‘˜ä¹‹é—´ï¼Œä»¥æ­¤ç±»æ¨ã€‚

`tag`å‡½æ•°çš„å…¶ä»–å‚æ•°ï¼Œéƒ½æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å„ä¸ªå˜é‡è¢«æ›¿æ¢åçš„å€¼ã€‚ç”±äºæœ¬ä¾‹ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å«æœ‰ä¸¤ä¸ªå˜é‡ï¼Œå› æ­¤`tag`ä¼šæ¥å—åˆ°`value1`å’Œ`value2`ä¸¤ä¸ªå‚æ•°ã€‚

`tag`å‡½æ•°æ‰€æœ‰å‚æ•°çš„å®é™…å€¼å¦‚ä¸‹ã€‚

- ç¬¬ä¸€ä¸ªå‚æ•°ï¼š`['Hello ', ' world', '']`
- ç¬¬äºŒä¸ªå‚æ•°ï¼š 15
- ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š50

ä¹Ÿå°±æ˜¯è¯´ï¼Œ`tag`å‡½æ•°å®é™…ä¸Šä»¥ä¸‹é¢çš„å½¢å¼è°ƒç”¨ã€‚

```javascripit
tag(['Hello ', ' world ', ''], 15, 50)
```

**"æ ‡ç­¾æ¨¡æ¿"çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œå°±æ˜¯è¿‡æ»¤ HTML å­—ç¬¦ä¸²ï¼Œé˜²æ­¢ç”¨æˆ·è¾“å…¥æ¶æ„å†…å®¹ã€‚**

```javascript
let message = 
	SaferHTML`<p>${sender} has sent you a message.</p>`;

function SaferHTML(templateData) {
	let s = templateData[0];
	for (let i = 1; i < arguments.length; i++) {
		let arg = String(arguments[i]);

		s += arg.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;");

		s += templateData[i];
	}
	return s;
}
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`sender`å˜é‡å¾€å¾€æ˜¯ç”¨æˆ·æä¾›çš„ï¼Œç»è¿‡`SaferHTML`å‡½æ•°å¤„ç†ï¼Œé‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦éƒ½ä¼šè¢«è½¬ä¹‰ã€‚

```javascript
let sender = '<script>alert("abc")</script>'; // æ¶æ„ä»£ç 
let message = 
	SaferHTML`<p>${sender} has sent you a message.</p>`;
console.log(message); 
// <p>&lt;script&gt;alert("abc")&lt;/script&gt; has sent you a message.</p>
```

**æ ‡ç­¾æ¨¡æ¿çš„å¦ä¸€ä¸ªåº”ç”¨ï¼Œå°±æ˜¯å¤šè¯­è¨€è½¬æ¢ï¼ˆå›½é™…åŒ–å¤„ç†ï¼‰ã€‚**

```javascript
i18n`Welcome to ${sitename}, you are visitor number ${visitorNumber}!`;
```

æ¨¡æ¿å¤„ç†å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ¨¡æ¿å­—ç¬¦ä¸²æ•°ç»„ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ª`raw`å±æ€§ã€‚

```javascript
console.log`123`;
// ["123", raw: Array[1]]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`console.log`æ¥å—çš„å‚æ•°ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ•°ç»„æœ‰ä¸€ä¸ª`raw`å±æ€§ï¼Œä¿å­˜çš„æ˜¯è½¬ä¹‰åçš„åŸå­—ç¬¦ä¸²ã€‚

è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚

```javascript
tag`First line\nSecond line`

function tag(strings) {
  console.log(strings.raw[0]);
  // strings.raw[0] ä¸º "First line\\nSecond line"
  // æ‰“å°è¾“å‡º â€œFirst line \nSecond lineâ€
}
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`tag`å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°`strings`ï¼Œæœ‰ä¸€ä¸ª`raw`å±æ€§ï¼Œä¹ŸæŒ‡å‘ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ•°ç»„çš„æˆå‘˜ä¸`strings`æ•°ç»„å®Œå…¨ä¸€è‡´ã€‚æ¯”å¦‚ï¼Œ`strings`æ•°ç»„æ˜¯`["First line\nSecond line"]`ï¼Œé‚£ä¹ˆ`strings.raw`æ•°ç»„å°±æ˜¯`["First line\\nSecond line"]`ã€‚ä¸¤è€…å”¯ä¸€çš„åŒºåˆ«ï¼Œå°±æ˜¯å­—ç¬¦ä¸²é‡Œé¢çš„æ–œæ†éƒ½è¢«è½¬ä¹‰äº†ã€‚

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n11.js)

## <a name="13">String.raw()</a>

ES6 è¿˜ä¸ºåŸç”Ÿçš„ String å¯¹è±¡ï¼Œæä¾›äº†ä¸€ä¸ª`raw`æ–¹æ³•ã€‚

`String.raw`æ–¹æ³•ï¼Œå¾€å¾€ç”¨æ¥å……å½“æ¨¡æ¿å­—ç¬¦ä¸²çš„å¤„ç†å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–œæ†éƒ½è¢«è½¬ä¹‰ï¼ˆå³æ–œæ†å‰é¢å†åŠ ä¸€ä¸ªæ–œæ†ï¼‰çš„å­—ç¬¦ä¸²ï¼Œå¯¹åº”äºæ›¿æ¢å˜é‡åçš„æ¨¡æ¿å­—ç¬¦ä¸²ã€‚

```javascript
let hi = String.raw`Hi\n${2+3}!`; // è¿”å› Hi\\n5!
console.log(hi); // Hi\n5!
```

å¦‚æœåŸå­—ç¬¦ä¸²çš„æ–œæ†å·²ç»è½¬ä¹‰ï¼Œé‚£ä¹ˆ`String.raw`ä¼šè¿›è¡Œå†æ¬¡è½¬ä¹‰ã€‚

```javascript
	let s = String.raw`Hi\\n`; // è¿”å› Hi\\\\n
	console.log(s); // Hi\\n
```

`String.raw`æ–¹æ³•å¯ä»¥ä½œä¸ºå¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²çš„åŸºæœ¬æ–¹æ³•ï¼Œå®ƒä¼šå°†æ‰€æœ‰å˜é‡æ›¿æ¢ï¼Œè€Œä¸”å¯¹æ–œæ†è¿›è¡Œè½¬ä¹‰ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ­¥ä½œä¸ºå­—ç¬¦ä¸²æ¥ä½¿ç”¨ã€‚

`String.raw`æ–¹æ³•ä¹Ÿå¯ä»¥ä½œä¸ºæ­£å¸¸çš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ—¶ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå…·æœ‰`raw`å±æ€§çš„å¯¹è±¡ï¼Œä¸”`raw`å±æ€§çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

```javascript
	let s = String.raw({ raw: 'test' }, 0, 1, 2);
	console.log(s); // t0e1s2t

	// ç­‰åŒäº
	String.raw({ raw: ['t', 'e', 's', 't'] }, 0, 1, 2);
```

ä½œä¸ºå‡½æ•°ï¼Œ`String.raw`çš„ä»£ç å®ç°åŸºæœ¬å¦‚ä¸‹ã€‚

```javascript
String.raw = function (strings, ...values) {
  let output = '';
  let index;
  for (index = 0; index < values.length; index++) {
    output += strings.raw[index] + values[index];
  }
  
  output += strings.raw[index];
  return output;
}
```

[code](https://github.com/hewq/ECMAScript6/blob/master/apps/n04stringextend/n12.js)

## <a name="14">æ¨¡æ¿å­—ç¬¦ä¸²çš„é™åˆ¶</a>

å‰é¢æåˆ°æ ‡ç­¾æ¨¡æ¿é‡Œé¢ï¼Œå¯ä»¥å†…åµŒå…¶ä»–è¯­è¨€ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²é»˜è®¤ä¼šå°†å­—ç¬¦ä¸²è½¬ä¹‰ï¼Œå¯¼è‡´æ— æ³•åµŒå…¥å…¶ä»–è¯­è¨€ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œæ ‡ç­¾æ¨¡æ¿é‡Œé¢å¯ä»¥åµŒå…¥ LaTEX è¯­è¨€ã€‚

```javascript
function latex(strings) {
  // ...
}

let document = latex`
\newcommand{\fun}{\textbf{Fun!}}  // æ­£å¸¸å·¥ä½œ
\newcommand{\unicode}{\textbf{Unicode!}} // æŠ¥é”™
\newcommand{\xerxes}{\textbf{King!}} // æŠ¥é”™

Breve over the h goes \u{h}ere // æŠ¥é”™
`
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡`document`å†…åµŒçš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå¯¹äº LaTEX è¯­è¨€æ¥è¯´å®Œå…¨æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ JavaScript å¼•æ“ä¼šæŠ¥é”™ã€‚åŸå› å°±åœ¨äºå­—ç¬¦ä¸²çš„è½¬ä¹‰ã€‚

æ¨¡æ¿å­—ç¬¦ä¸²ä¼šå°†`\u00FF`å’Œ`\u{42}`å½“ä½œ Unicode å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€ä»¥`\unicode`è§£ææ—¶æŠ¥é”™ï¼›è€Œ`\x56`ä¼šè¢«å½“ä½œåå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬ä¹‰ï¼Œæ‰€ä»¥`\xerxes`ä¼šæŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`\u`å’Œ`\x`åœ¨ LaTEX é‡Œé¢æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œä½†æ˜¯ JavaScript å°†å®ƒä»¬è½¬ä¹‰äº†ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒES2018 [æ”¾æ¾](https://tc39.github.io/proposal-template-literal-revision/)äº†å¯¹æ ‡ç­¾æ¨¡æ¿é‡Œé¢çš„å­—ç¬¦ä¸²è½¬ä¹‰çš„é™åˆ¶ã€‚å¦‚æœé‡åˆ°ä¸åˆæ³•çš„å­—ç¬¦ä¸²è½¬ä¹‰ï¼Œå°±è¿”å›`undefined`ï¼Œè€Œä¸æ˜¯æŠ¥é”™ï¼Œå¹¶ä¸”ä»`raw`å±æ€§ä¸Šé¢å¯ä»¥å¾—åˆ°åŸå§‹å­—ç¬¦ä¸²ã€‚

```javascript
function tag(strs) {
  strs[0] === undefined
  strs.raw[0] === "\\unicode and \\u{55}";
}
tag`\unicode and \u{55}`
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²åŸæœ¬æ˜¯åº”è¯¥æŠ¥é”™çš„ï¼Œä½†æ˜¯ç”±äºæ”¾æ¾äº†å¯¹å­—ç¬¦ä¸²è½¬ä¹‰çš„é™åˆ¶ï¼Œæ‰€ä»¥ä¸æŠ¥é”™äº†ï¼ŒJavaScript å¼•æ“å°†ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾ç½®ä¸º`undefined`ï¼Œä½†æ˜¯`raw`å±æ€§ä¾ç„¶å¯ä»¥å¾—åˆ°åŸå§‹å­—ç¬¦ä¸²ï¼Œå› æ­¤`tag`å‡½æ•°è¿˜æ˜¯å¯ä»¥å¯¹åŸå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ã€‚

æ³¨æ„ï¼Œè¿™ç§å¯¹å­—ç¬¦ä¸²è½¬ä¹‰çš„æ”¾æ¾ï¼Œåªåœ¨æ ‡ç­¾æ¨¡æ¿è§£æå­—ç¬¦ä¸²æ—¶ç”Ÿæ•ˆï¼Œä¸æ˜¯æ ‡ç­¾æ¨¡æ¿çš„åœºåˆï¼Œä¾ç„¶ä¼šæŠ¥é”™ã€‚

```javascript
let bad = `bad escape sequence: \unicode`; // æŠ¥é”™
```

